<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Primeiro Jogo Multiplayer</title>

    <link rel="stylesheet" href="./style.css">
    
</head>
<body>
    <canvas id="screen" width="10" height="10"></canvas>
    <script>
        const screen = document.getElementById('screen')
        const context = screen.getContext('2d')
        const ideintificador_jogador_atual = 'jogador1'



        function createGame(){
            const state = {
                Jogadores: {
                    'jogador1' : { X : 1,Y: 1},
                    'jogador2' : { X : 9,Y: 9}
                }
                ,
                Frutas : {
                    'Fruta1': { X : 4, Y : 4 },
                    'Fruta2': { X : 15,Y :15 }
                }
            }      

            function movePlayer(comando){
                console.log(`Movendo ${comando.id_jogador} with ${comando.teclaPressionada} `)

                const teclaPressionada = comando.teclaPressionada
                const jogador = state.Jogadores[comando.id_jogador]

               // const player = state.Jogadores[ideintificador_jogador_atual]
//&& jogador.Y - 1 >= 0
// neste pedaço permite o jogador ultrapassar a dimensão do canvas de apenas 10 pixels
//Para ajeitar é somente n permitir o personagem esta posicionado em numeros negativo - poê no if para so passar numero positivo
                if(teclaPressionada === 'ArrowUp' && jogador.Y - 1 >= 0 ){
                    jogador.Y -= 1
                    console.log('Up')
                    return
                }
                if(teclaPressionada === 'ArrowLeft' && jogador.X - 1 >= 0){
                    jogador.X -= 1
                    console.log('Left')
                    return
                }
                if(teclaPressionada === 'ArrowRight' && jogador.X + 1 < screen.width){
                    jogador.X  += 1
                    console.log('Right')
                    return
                }
                if(teclaPressionada === 'ArrowDown' && jogador.Y + 1 < screen.height){
                    jogador.Y += 1
                    console.log('Down')
                    return
                }

                }
    /* Esta é uma função Create game que quando executada ela vai retornar um objeto e dentro deste objeto vai conseguir acessar uma propriedade chamada move player : que tem o valor sendo uma função que recebe no parametro um comando , e quando esta função/método for executada vai fazer um display no log do id daquele jogado que esta se mexendo e qual direção ele se mexeu*/
                return {
                    movePlayer
                } 
        }
        
        document.addEventListener("keydown", handleKeyDown)

        
        const game = createGame()
        

        function handleKeyDown(event){            
            const teclaPressionada = event.key
            
            const comando = {
                id_jogador : 'player1',
                teclaPressionada
            }

            game.movePlayer(comando) // este codigo aqui é da camada e logica+ regras = camada de jogo
        }

        renderScreen()

        function renderScreen(){
//
            context.fillStyle = 'white'
            context.clearRect(0,0,10,10)

            const cor1 = 'black'
            const cor2 = 'green'
            //para cada jogador , setar sua cor preta , dizer sua posição e seu tamanho
            for (const id_jogador in state.Jogadores){
                const jogador = state.Jogadores[id_jogador] // acessando cada objeto que é um dos jogadores
                context.fillStyle = cor1
                context.fillRect(jogador.X, jogador.Y, 1, 1)

            }

            for (const id_fruta in state.Frutas){
                const fruta = state.Frutas[id_fruta] // acessando cada objeto que é um dos jogadores
                context.fillStyle = cor2
                context.fillRect(fruta.X, fruta.Y, 1, 1)

            }

            requestAnimationFrame(renderScreen)
        }
    </script>
</body>
</html>